<!-- Embassy & High Commission Portal Dashboard -->
<div class="bg-white min-h-screen">
    <!-- Header Navigation -->
    <app-header />
    
    <!-- Embassy Dashboard Header -->
    <section class="bg-gradient-to-r from-blue-800 to-indigo-900 py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                <div class="flex items-center">
                    <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mr-6 shadow-lg">
                        <i class="ri-government-line text-blue-800 text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-white mb-1">{{ embassy.name }}</h1>
                        <p class="text-blue-100">{{ embassy.type | titlecase }} - {{ embassy.country }}</p>
                        <p class="text-blue-200 text-sm">Secure Medical Credential Verification Portal</p>
                        <p class="text-blue-200 text-xs mt-1" *ngIf="currentUser">
                            Logged in as: {{ currentUser.email }}
                        </p>
                    </div>
                </div>
                <div class="flex items-center space-x-3 mt-4 md:mt-0">
                    <div class="text-right text-white">
                        <div class="text-sm">Subscription: {{ embassy.subscriptionTier | titlecase }}</div>
                        <div class="text-xs text-blue-200" *ngIf="embassy.subscriptionExpiry">
                            Expires: {{ embassy.subscriptionExpiry | date:'mediumDate' }}
                        </div>
                        <div class="flex items-center mt-1">
                            <i class="ri-shield-check-line text-green-400 mr-1"></i>
                            <span class="text-xs text-green-400">MFA Enabled</span>
                        </div>
                    </div>
                    <button (click)="logout()" 
                            class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition font-medium">
                        <i class="ri-logout-box-line mr-2"></i>
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Security Notice -->
    <section class="py-4 bg-yellow-50 border-b border-yellow-200">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-center">
                <div class="flex items-center text-yellow-800">
                    <i class="ri-shield-line mr-2"></i>
                    <span class="text-sm font-medium">
                        Secure Portal - All verification activities are logged and monitored
                    </span>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Quick Stats Overview -->
    <section class="py-8 bg-gray-50">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Total Verifications -->
                <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Total Verifications</p>
                            <p class="text-2xl font-bold text-gray-900">{{ formatNumber(embassy.totalVerifications) }}</p>
                            <p class="text-xs text-gray-500 mt-1">All time</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="ri-shield-check-line text-blue-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <!-- This Month -->
                <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">This Month</p>
                            <p class="text-2xl font-bold text-gray-900">{{ formatNumber(verificationStats.totalThisMonth) }}</p>
                            <p class="text-xs text-green-600 mt-1">{{ formatNumber(subscriptionUsage.remaining) }} remaining</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                            <i class="ri-calendar-line text-green-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Success Rate -->
                <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-purple-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Success Rate</p>
                            <p class="text-2xl font-bold text-gray-900">
                                {{ formatPercentage((verificationStats.successfulVerifications / verificationStats.totalThisMonth) * 100) }}
                            </p>
                            <p class="text-xs text-purple-600 mt-1">{{ formatNumber(verificationStats.successfulVerifications) }}/{{ formatNumber(verificationStats.totalThisMonth) }}</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <i class="ri-check-double-line text-purple-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Response Time -->
                <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-orange-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Avg Response Time</p>
                            <p class="text-2xl font-bold text-gray-900">{{ verificationStats.averageResponseTime }}s</p>
                            <p class="text-xs text-orange-600 mt-1">Real-time verification</p>
                        </div>
                        <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                            <i class="ri-time-line text-orange-600 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Single Verification -->
                <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                            <i class="ri-user-search-line text-blue-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Single Verification</h3>
                            <p class="text-sm text-gray-600">Verify individual practitioner</p>
                        </div>
                    </div>
                    <a routerLink="/embassy/verification" 
                       class="w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition font-medium text-center block">
                        <i class="ri-search-line mr-2"></i>
                        Start Verification
                    </a>
                </div>

                <!-- Batch Verification -->
                <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4">
                            <i class="ri-file-list-3-line text-green-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Batch Verification</h3>
                            <p class="text-sm text-gray-600">Upload CSV for bulk processing</p>
                        </div>
                    </div>
                    <a routerLink="/embassy/batch-verification" 
                       class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition font-medium text-center block">
                        <i class="ri-upload-line mr-2"></i>
                        Batch Upload
                    </a>
                </div>

                <!-- Official Letters -->
                <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mr-4">
                            <i class="ri-file-text-line text-purple-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Official Letters</h3>
                            <p class="text-sm text-gray-600">Generate verification letters</p>
                        </div>
                    </div>
                    <a routerLink="/embassy/official-letters" 
                       class="w-full bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition font-medium text-center block">
                        <i class="ri-file-download-line mr-2"></i>
                        Manage Letters
                    </a>
                </div>

                <!-- Audit Logs -->
                <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mr-4">
                            <i class="ri-history-line text-orange-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Audit Logs</h3>
                            <p class="text-sm text-gray-600">View verification history</p>
                        </div>
                    </div>
                    <a routerLink="/embassy/audit-logs" 
                       class="w-full bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition font-medium text-center block">
                        <i class="ri-eye-line mr-2"></i>
                        View Logs
                    </a>
                </div>

                <!-- Billing Management -->
                <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4">
                            <i class="ri-money-dollar-circle-line text-red-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Billing & Usage</h3>
                            <p class="text-sm text-gray-600">Subscription management</p>
                        </div>
                    </div>
                    <a routerLink="/embassy/billing" 
                       class="w-full bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition font-medium text-center block">
                        <i class="ri-wallet-line mr-2"></i>
                        Manage Billing
                    </a>
                </div>

                <!-- Security Settings -->
                <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mr-4">
                            <i class="ri-shield-keyhole-line text-gray-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Security Settings</h3>
                            <p class="text-sm text-gray-600">MFA & IP whitelisting</p>
                        </div>
                    </div>
                    <button class="w-full bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition font-medium">
                        <i class="ri-settings-line mr-2"></i>
                        Configure Security
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Dashboard Content -->
    <section class="py-8">
        <div class="container mx-auto px-4">
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Main Content -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Recent Verifications -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-semibold text-gray-800">Recent Verifications</h2>
                            <a routerLink="/embassy/verification" 
                               class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition text-sm font-medium">
                                <i class="ri-add-line mr-2"></i>
                                New Verification
                            </a>
                        </div>
                        
                        <div class="space-y-4">
                            <div *ngFor="let verification of recentVerifications" 
                                 class="border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-shadow">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-start">
                                        <div class="w-10 h-10 rounded-full flex items-center justify-center mr-4"
                                             [ngClass]="verification.status === 'verified' ? 'bg-green-100' : 
                                                        verification.status === 'suspended' ? 'bg-orange-100' : 
                                                        verification.status === 'revoked' ? 'bg-red-100' : 'bg-gray-100'">
                                            <i [ngClass]="getPurposeIcon(verification.purpose)" 
                                               [ngClass]="verification.status === 'verified' ? 'text-green-600' : 
                                                          verification.status === 'suspended' ? 'text-orange-600' : 
                                                          verification.status === 'revoked' ? 'text-red-600' : 'text-gray-600'"></i>
                                        </div>
                                        <div class="flex-1">
                                            <h3 class="font-medium text-gray-800">{{ verification.practitionerName }}</h3>
                                            <p class="text-sm text-gray-600">{{ verification.profession }}
                                                <span *ngIf="verification.specialty"> - {{ verification.specialty }}</span>
                                            </p>
                                            <p class="text-sm text-gray-500">License: {{ verification.licenseNumber }}</p>
                                            <div class="flex items-center mt-2">
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                                      [ngClass]="getStatusColor(verification.status)">
                                                    {{ verification.status | titlecase }}
                                                </span>
                                                <span class="text-xs text-gray-500 ml-3">
                                                    {{ verification.purpose | titlecase }}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm text-gray-600">{{ verification.verificationDate | date:'medium' }}</div>
                                        <div class="text-xs text-gray-500">{{ verification.requestedBy }}</div>
                                        <div class="mt-2 space-y-1">
                                            <button *ngIf="!verification.officialLetterGenerated && verification.status === 'verified'" 
                                                    (click)="generateOfficialLetter(verification.id)"
                                                    class="bg-blue-500 text-white px-3 py-1 rounded text-xs hover:bg-blue-600 transition block">
                                                <i class="ri-file-add-line mr-1"></i>Generate Letter
                                            </button>
                                            <button *ngIf="verification.officialLetterGenerated" 
                                                    (click)="downloadLetter(verification.letterReference!)"
                                                    class="bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600 transition block">
                                                <i class="ri-download-line mr-1"></i>{{ verification.letterReference }}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Verification Analytics -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-6">Verification Analytics</h2>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- By Profession -->
                            <div>
                                <h3 class="font-medium text-gray-800 mb-4">By Profession</h3>
                                <div class="space-y-3">
                                    <div *ngFor="let prof of verificationStats.verificationsByProfession" 
                                         class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                                            <span class="text-sm text-gray-700">{{ prof.profession }}</span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-sm font-medium text-gray-800">{{ formatNumber(prof.count) }}</span>
                                            <span class="text-xs text-gray-500 ml-2">({{ formatPercentage(prof.percentage) }})</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- By Country -->
                            <div>
                                <h3 class="font-medium text-gray-800 mb-4">By Country</h3>
                                <div class="space-y-3">
                                    <div *ngFor="let country of verificationStats.verificationsByCountry" 
                                         class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                            <span class="text-sm text-gray-700">{{ country.country }}</span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-sm font-medium text-gray-800">{{ formatNumber(country.count) }}</span>
                                            <span class="text-xs text-gray-500 ml-2">({{ formatPercentage(country.percentage) }})</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Subscription Usage -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Subscription Usage</h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-sm mb-2">
                                    <span class="text-gray-600">Verifications</span>
                                    <span class="font-medium">{{ formatNumber(subscriptionUsage.used) }}/{{ formatNumber(subscriptionUsage.monthlyLimit) }}</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-500 h-2 rounded-full" 
                                         [style.width.%]="subscriptionUsage.percentageUsed"></div>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">
                                    {{ formatPercentage(subscriptionUsage.percentageUsed) }} used this month
                                </div>
                            </div>
                            
                            <div class="pt-4 border-t border-gray-200">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Current Plan</span>
                                    <span class="font-medium text-gray-800">{{ subscriptionUsage.plan | titlecase }}</span>
                                </div>
                                <div class="flex justify-between text-sm mt-2">
                                    <span class="text-gray-600">Monthly Cost</span>
                                    <span class="font-medium text-gray-800">{{ formatCurrency(subscriptionUsage.currentMonthCost) }}</span>
                                </div>
                                <div class="flex justify-between text-sm mt-2">
                                    <span class="text-gray-600">Next Billing</span>
                                    <span class="font-medium text-gray-800">{{ subscriptionUsage.nextBillingDate | date:'mediumDate' }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top Requesting Officers -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Top Requesting Officers</h3>
                        <div class="space-y-3">
                            <div *ngFor="let officer of verificationStats.topRequestingOfficers" 
                                 class="flex items-center justify-between">
                                <div>
                                    <div class="text-sm font-medium text-gray-800">{{ officer.name }}</div>
                                    <div class="text-xs text-gray-500">{{ officer.department }}</div>
                                </div>
                                <div class="text-sm font-semibold text-gray-800">{{ formatNumber(officer.count) }}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Security Status -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Security Status</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">MFA Status</span>
                                <span class="flex items-center text-green-600">
                                    <i class="ri-shield-check-line mr-1"></i>
                                    Enabled
                                </span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">IP Whitelist</span>
                                <span class="text-gray-800">{{ embassy.whitelistedIPs.length }} IPs</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-600">Last Access</span>
                                <span class="text-gray-800">{{ embassy.lastVerification | date:'short' }}</span>
                            </div>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <h4 class="font-medium text-gray-800 mb-2 text-sm">Whitelisted IPs</h4>
                            <div class="space-y-1">
                                <div *ngFor="let ip of embassy.whitelistedIPs" 
                                     class="text-xs font-mono text-gray-600 bg-gray-50 px-2 py-1 rounded">
                                    {{ ip }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Stats</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Successful Verifications</span>
                                <span class="font-semibold text-green-600">{{ formatNumber(verificationStats.successfulVerifications) }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Failed Verifications</span>
                                <span class="font-semibold text-red-600">{{ formatNumber(verificationStats.failedVerifications) }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Letters Generated</span>
                                <span class="font-semibold text-blue-600">
                                    {{ getLettersGeneratedCount() }}
                                </span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Average Response</span>
                                <span class="font-semibold text-gray-800">{{ formatNumber(verificationStats.averageResponseTime) }}s</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <app-footer />
</div>