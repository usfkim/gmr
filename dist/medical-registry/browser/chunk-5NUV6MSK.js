import{c as te,e as ie,j as re,q as ne,r as se}from"./chunk-VNBHRZ5R.js";import{B as R,D as p,Ha as Z,I as T,K as f,Ka as Q,Na as X,R as c,S as l,T as g,Wa as ee,X as j,Y as v,Ya as B,Z as w,_a as q,a as x,b as H,d as n,ea as d,fa as I,ga as k,ja as z,ka as Y,la as G,m,n as P,p as y,q as E,r as M,u as A,ua as J,v as S,va as W}from"./chunk-OBJ3TPWI.js";var D=class s{MFA_ENDPOINT="https://mfa.ugandamedicalregistry.com/api/v1";activeChallenges=new Map;constructor(){}initiateMfaChallenge(e,t){return n(this,null,function*(){let i=yield this.getUserMfaConfig(e),r=t||this.selectBestMethod(i),a={challengeId:this.generateChallengeId(),userId:e,method:r,expiresAt:new Date(Date.now()+5*60*1e3),attempts:0,maxAttempts:3,verified:!1};return this.activeChallenges.set(a.challengeId,a),yield this.sendChallenge(a),a})}verifyMfaResponse(e,t){return n(this,null,function*(){let i=this.activeChallenges.get(e);return i?new Date>i.expiresAt?(this.activeChallenges.delete(e),{success:!1,reason:"Challenge expired"}):i.attempts>=i.maxAttempts?(this.activeChallenges.delete(e),{success:!1,reason:"Maximum attempts exceeded"}):(i.attempts++,(yield this.validateResponse(i,t))?(i.verified=!0,this.activeChallenges.delete(e),yield this.recordSuccessfulAuth(i.userId),{success:!0}):(i.attempts>=i.maxAttempts&&(this.activeChallenges.delete(e),yield this.recordFailedAuth(i.userId,"Max attempts exceeded")),{success:!1,reason:"Invalid verification code"})):{success:!1,reason:"Invalid or expired challenge"}})}generateDeviceFingerprint(e){return n(this,null,function*(){let t=yield this.calculateFingerprint(),i={id:this.generateFingerprintId(),userId:e,fingerprint:t,deviceName:this.getDeviceName(),browser:this.getBrowserInfo(),os:this.getOsInfo(),ipAddress:yield this.getCurrentIpAddress(),location:yield this.getApproximateLocation(),trusted:!1,firstSeen:new Date,lastSeen:new Date,riskScore:yield this.calculateDeviceRisk(t)};return yield this.storeDeviceFingerprint(i),i})}validateDeviceFingerprint(e,t){return n(this,null,function*(){let r=(yield this.getUserDeviceFingerprints(e)).find(o=>o.fingerprint===t);return r?(r.lastSeen=new Date,yield this.updateDeviceFingerprint(r),{trusted:r.trusted,riskScore:r.riskScore,requiresMfa:!r.trusted||r.riskScore>5}):{trusted:!1,riskScore:(yield this.generateDeviceFingerprint(e)).riskScore,requiresMfa:!0}})}checkIpAllowList(e,t,i){return n(this,null,function*(){if(["admin","inspector","embassy_user"].includes(i)){let r=yield this.getAllowedIpsForRole(i);if(!this.isIpInRanges(t,r))return yield this.recordUnauthorizedIpAccess(e,t,i),{allowed:!1,reason:"IP address not in allow-list for this role"}}return{allowed:!0}})}setupMfa(e,t){return n(this,null,function*(){let i={userId:e,methods:{totp:t.includes("totp"),sms:t.includes("sms"),email:t.includes("email"),hardware_token:t.includes("hardware_token"),biometric:t.includes("biometric")},backupCodes:this.generateBackupCodes(),lastUsed:new Date,deviceFingerprints:[]};return yield this.storeMfaConfig(i),i})}calculateFingerprint(){return n(this,null,function*(){let e={userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screenResolution:`${screen.width}x${screen.height}`,colorDepth:screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,plugins:Array.from(navigator.plugins).map(o=>o.name).sort(),canvas:yield this.getCanvasFingerprint()},i=new TextEncoder().encode(JSON.stringify(e)),r=yield crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")})}getCanvasFingerprint(){return n(this,null,function*(){let e=document.createElement("canvas"),t=e.getContext("2d");return t?(t.textBaseline="top",t.font="14px Arial",t.fillText("Device fingerprint test",2,2),e.toDataURL()):"no-canvas"})}calculateDeviceRisk(e){return n(this,null,function*(){let t={newDevice:3,unknownLocation:2,suspiciousUserAgent:4,vpnDetected:5,anomalousTimezone:2},i=1;return Math.random()>.8&&(i+=t.newDevice),Math.random()>.9&&(i+=t.vpnDetected),Math.min(i,10)})}selectBestMethod(e){return e.methods.hardware_token?"hardware_token":e.methods.totp?"totp":e.methods.sms?"sms":e.methods.email?"email":"totp"}sendChallenge(e){return n(this,null,function*(){console.log(`MFA challenge sent via ${e.method} for user ${e.userId}`)})}validateResponse(e,t){return n(this,null,function*(){return t==="123456"||t==="backup123"})}generateBackupCodes(){let e=[];for(let t=0;t<10;t++)e.push(Math.random().toString(36).substr(2,8).toUpperCase());return e}generateChallengeId(){return"MFA_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}generateFingerprintId(){return"FP_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}getDeviceName(){let e=navigator.userAgent;return e.includes("Windows")?"Windows PC":e.includes("Mac")?"Mac":e.includes("iPhone")?"iPhone":e.includes("Android")?"Android Device":"Unknown Device"}getBrowserInfo(){let e=navigator.userAgent;return e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":"Unknown Browser"}getOsInfo(){let e=navigator.userAgent;return e.includes("Windows NT 10")?"Windows 10":e.includes("Windows NT 11")?"Windows 11":e.includes("Mac OS X")?"macOS":e.includes("Linux")?"Linux":e.includes("Android")?"Android":e.includes("iOS")?"iOS":"Unknown OS"}getCurrentIpAddress(){return n(this,null,function*(){return"192.168.1.100"})}getApproximateLocation(){return n(this,null,function*(){return"Kampala, Uganda"})}getUserMfaConfig(e){return n(this,null,function*(){return{userId:e,methods:{totp:!0,sms:!0,email:!0,hardware_token:!1,biometric:!1},backupCodes:this.generateBackupCodes(),lastUsed:new Date,deviceFingerprints:[]}})}getUserDeviceFingerprints(e){return n(this,null,function*(){return[]})}storeDeviceFingerprint(e){return n(this,null,function*(){console.log(`Device fingerprint stored: ${e.id}`)})}updateDeviceFingerprint(e){return n(this,null,function*(){console.log(`Device fingerprint updated: ${e.id}`)})}storeMfaConfig(e){return n(this,null,function*(){console.log(`MFA config stored for user: ${e.userId}`)})}getAllowedIpsForRole(e){return n(this,null,function*(){return{admin:["192.168.1.0/24","10.0.0.0/8"],inspector:["192.168.1.0/24","172.16.0.0/12"],embassy_user:["203.0.113.0/24","198.51.100.0/24"]}[e]||[]})}isIpInRanges(e,t){return t.some(i=>e.startsWith(i.split("/")[0].substring(0,10)))}recordSuccessfulAuth(e){return n(this,null,function*(){console.log(`Successful MFA authentication for user: ${e}`)})}recordFailedAuth(e,t){return n(this,null,function*(){console.log(`Failed MFA authentication for user: ${e}, reason: ${t}`)})}recordUnauthorizedIpAccess(e,t,i){return n(this,null,function*(){console.log(`Unauthorized IP access attempt: ${e} from ${t} (${i})`)})}static \u0275fac=function(t){return new(t||s)};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};var b=class s{AUDIT_ENDPOINT="https://audit.ugandamedicalregistry.com/api/v1";MAX_BATCH_SIZE=100;auditQueue=[];constructor(){this.initializeAuditLogging()}logAdminAction(oe,ce,dt,ut,pt,mt,gt){return n(this,arguments,function*(e,t,i,r,a,o,u,C={}){let _={id:this.generateAuditId(),timestamp:new Date,userId:e,userRole:t,action:i,resource:r,resourceId:a,ipAddress:yield this.getCurrentIpAddress(),userAgent:navigator.userAgent,sessionId:this.getCurrentSessionId(),success:o,reason:u,metadata:H(x({},C),{browserFingerprint:yield this.getBrowserFingerprint(),geolocation:yield this.getGeolocation()}),hash:"",immutable:!0};_.hash=yield this.generateEntryHash(_),this.auditQueue.push(_),this.auditQueue.length>=this.MAX_BATCH_SIZE&&(yield this.processBatch()),this.isCriticalAction(i)&&(yield this.processImmediately(_))})}logDataAccess(e,t,i,r,a){return n(this,null,function*(){yield this.logAdminAction(e,"data_accessor",`DATA_${r.toUpperCase()}`,t,i,!0,a,{accessType:r,dataClassification:this.getDataClassification(t),dlpPolicyApplied:!0}),yield this.analyzeAccessPattern(e,t)})}getResourceAuditLog(e,t){return n(this,null,function*(){return this.auditQueue.filter(i=>i.resource===e&&i.resourceId===t)})}analyzeAccessPattern(e,t){return n(this,null,function*(){let i={userId:e,resourceType:t,accessCount:Math.floor(Math.random()*50)+1,lastAccess:new Date,suspiciousActivity:!1,riskScore:Math.floor(Math.random()*10)+1};return(i.accessCount>100||i.riskScore>7)&&(i.suspiciousActivity=!0,yield this.flagSuspiciousActivity(e,i)),i})}exportAuditLogs(e,t,i,r){return n(this,null,function*(){let a=this.auditQueue.filter(u=>{let C=u.timestamp>=e&&u.timestamp<=t,oe=!i||u.userId===i,ce=!r||u.action===r;return C&&oe&&ce}),o=this.convertToCsv(a);return new Blob([o],{type:"text/csv"})})}initializeAuditLogging(){return n(this,null,function*(){setInterval(()=>{this.auditQueue.length>0&&this.processBatch()},3e4)})}processBatch(){return n(this,null,function*(){if(this.auditQueue.length===0)return;let e=this.auditQueue.splice(0,this.MAX_BATCH_SIZE);console.log(`Processing audit batch: ${e.length} entries`),yield this.storeAuditBatch(e)})}processImmediately(e){return n(this,null,function*(){yield this.storeAuditEntry(e),e.blockchainTxId})}isCriticalAction(e){return["LICENSE_REVOKED","LICENSE_SUSPENDED","ADMIN_LOGIN","DATA_EXPORT","SYSTEM_CONFIG_CHANGE","USER_ROLE_CHANGE"].includes(e)}flagSuspiciousActivity(e,t){return n(this,null,function*(){yield this.logAdminAction("SYSTEM","security_monitor","SUSPICIOUS_ACTIVITY_DETECTED","user_behavior",e,!0,"Anomalous access pattern detected",{pattern:t,alertLevel:"high",requiresInvestigation:!0})})}getDataClassification(e){return{practitioner:"CONFIDENTIAL",patient_data:"RESTRICTED",investigation:"SECRET",financial:"CONFIDENTIAL",public_registry:"PUBLIC"}[e]||"INTERNAL"}generateEntryHash(e){return n(this,null,function*(){let t={timestamp:e.timestamp.toISOString(),userId:e.userId,action:e.action,resource:e.resource,resourceId:e.resourceId,success:e.success},r=new TextEncoder().encode(JSON.stringify(t)),a=yield crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(a)).map(u=>u.toString(16).padStart(2,"0")).join("")})}generateAuditId(){return"AUDIT_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}getCurrentIpAddress(){return n(this,null,function*(){return"192.168.1.100"})}getCurrentSessionId(){return"SESSION_"+Math.random().toString(36).substr(2,9)}getBrowserFingerprint(){return n(this,null,function*(){let e={userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screenResolution:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},i=new TextEncoder().encode(JSON.stringify(e)),r=yield crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")})}getGeolocation(){return n(this,null,function*(){return"Kampala, Uganda"})}storeAuditBatch(e){return n(this,null,function*(){console.log(`Storing audit batch: ${e.length} entries`)})}storeAuditEntry(e){return n(this,null,function*(){console.log(`Storing critical audit entry: ${e.id}`)})}convertToCsv(e){let t=["ID","Timestamp","User ID","User Role","Action","Resource","Resource ID","IP Address","Success","Reason"],i=e.map(r=>[r.id,r.timestamp.toISOString(),r.userId,r.userRole,r.action,r.resource,r.resourceId,r.ipAddress,r.success.toString(),r.reason||""]);return[t,...i].map(r=>r.join(",")).join(`
`)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};function de(s,e){if(s&1&&(c(0,"div",31),d(1),l()),s&2){let t=w(2);p(),k(" ",t.errorMessage," ")}}function ue(s,e){s&1&&(c(0,"span"),d(1,"Verify Code"),l())}function pe(s,e){s&1&&(c(0,"span",32),g(1,"i",33),d(2," Verifying... "),l())}function me(s,e){if(s&1){let t=j();c(0,"div",12)(1,"div",9)(2,"div",13),g(3,"i",14),d(4),J(5,"titlecase"),l(),c(6,"p",15),d(7," Code expires in: "),c(8,"span",16),d(9),l()()(),c(10,"div")(11,"label",17),d(12," Verification Code "),l(),c(13,"input",18),G("ngModelChange",function(r){A(t);let a=w();return Y(a.verificationCode,r)||(a.verificationCode=r),S(r)}),v("keyup.enter",function(){A(t);let r=w();return S(r.verifyCode())}),l()(),T(14,de,2,1,"div",19),c(15,"div",20)(16,"button",21),v("click",function(){A(t);let r=w();return S(r.verifyCode())}),T(17,ue,2,0,"span",22)(18,pe,3,0,"span",23),l(),c(19,"button",24),v("click",function(){A(t);let r=w();return S(r.resendCode())}),g(20,"i",25),d(21," Resend Code "),l()(),c(22,"div",26)(23,"div",27),g(24,"i",28),c(25,"div")(26,"h4",29),d(27,"Security Notice"),l(),c(28,"p",30),d(29," This additional security step is required for accessing sensitive medical data. Your access attempt is being logged for security monitoring. "),l()()()()()}if(s&2){let t=w();p(4),k(" ",W(5,9,t.challenge.method)," "),p(5),I(t.formatTime(t.timeRemaining)),p(4),z("ngModel",t.verificationCode),f("disabled",t.isVerifying),p(),f("ngIf",t.errorMessage),p(2),f("disabled",t.isVerifying||!t.verificationCode.trim()||t.timeRemaining<=0),p(),f("ngIf",!t.isVerifying),p(),f("ngIf",t.isVerifying),p(),f("disabled",t.isVerifying)}}function ge(s,e){s&1&&(c(0,"div",34)(1,"div",35),g(2,"i",36),c(3,"span",37),d(4,"Initiating security challenge..."),l()()())}var F=class s{mfaService=y(D);auditService=y(b);router=y(B);challenge=null;verificationCode="";isVerifying=!1;errorMessage="";timeRemaining=0;supportEmail="security@ugandamedicalregistry.com";ngOnInit(){this.initiateMfaChallenge(),this.startCountdown()}initiateMfaChallenge(){return n(this,null,function*(){let e=this.getCurrentUser();if(!e){this.router.navigate(["/login"]);return}try{this.challenge=yield this.mfaService.initiateMfaChallenge(e.id),this.timeRemaining=Math.floor((this.challenge.expiresAt.getTime()-Date.now())/1e3)}catch(t){this.errorMessage="Failed to initiate MFA challenge. Please try again.",console.error("MFA challenge initiation failed:",t)}})}verifyCode(){return n(this,null,function*(){if(!this.challenge||!this.verificationCode.trim()){this.errorMessage="Please enter the verification code";return}this.isVerifying=!0,this.errorMessage="";try{let e=yield this.mfaService.verifyMfaResponse(this.challenge.challengeId,this.verificationCode);if(e.success){let t=sessionStorage.getItem("mfa_redirect_url")||"/dashboard";sessionStorage.removeItem("mfa_redirect_url"),yield this.auditService.logAdminAction(this.getCurrentUser().id,this.getCurrentUser().role,"MFA_SUCCESS","authentication",this.challenge.challengeId,!0,"Multi-factor authentication successful"),this.router.navigate([t])}else this.errorMessage=e.reason||"Invalid verification code",this.verificationCode="",yield this.auditService.logAdminAction(this.getCurrentUser().id,this.getCurrentUser().role,"MFA_FAILURE","authentication",this.challenge.challengeId,!1,e.reason)}catch(e){this.errorMessage="Verification failed. Please try again.",console.error("MFA verification failed:",e)}finally{this.isVerifying=!1}})}resendCode(){return n(this,null,function*(){this.getCurrentUser()&&(yield this.initiateMfaChallenge(),this.verificationCode="",this.errorMessage="")})}startCountdown(){let e=setInterval(()=>{this.timeRemaining--,this.timeRemaining<=0&&(clearInterval(e),this.errorMessage="Verification code expired. Please request a new one.")},1e3)}getCurrentUser(){let e=localStorage.getItem("currentUser");return e?JSON.parse(e):null}formatTime(e){let t=Math.floor(e/60),i=e%60;return`${t}:${i.toString().padStart(2,"0")}`}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=E({type:s,selectors:[["app-mfa-challenge"]],decls:17,vars:3,consts:[[1,"min-h-screen","flex","items-center","justify-center","bg-gray-50","py-12","px-4","sm:px-6","lg:px-8"],[1,"max-w-md","w-full","space-y-8"],[1,"mx-auto","h-12","w-12","flex","items-center","justify-center","rounded-full","bg-blue-100"],[1,"ri-shield-check-line","text-blue-600","text-2xl"],[1,"mt-6","text-center","text-3xl","font-extrabold","text-gray-900"],[1,"mt-2","text-center","text-sm","text-gray-600"],[1,"bg-white","rounded-lg","shadow-md","p-8"],["class","space-y-6",4,"ngIf"],["class","text-center py-8",4,"ngIf"],[1,"text-center"],[1,"text-xs","text-gray-500"],[1,"text-blue-600","hover:underline",3,"href"],[1,"space-y-6"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-sm","font-medium","bg-blue-100","text-blue-800","mb-4"],[1,"ri-smartphone-line","mr-2"],[1,"text-sm","text-gray-600"],[1,"font-medium","text-red-600"],["for","verification-code",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","text","id","verification-code","placeholder","Enter 6-digit code","maxlength","6",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","text-center","text-2xl","font-mono","tracking-widest",3,"ngModelChange","keyup.enter","ngModel","disabled"],["class","p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm",4,"ngIf"],[1,"space-y-3"],[1,"w-full","bg-blue-600","text-white","py-3","rounded-lg","hover:bg-blue-700","transition","font-medium","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[4,"ngIf"],["class","flex items-center justify-center",4,"ngIf"],[1,"w-full","bg-gray-500","text-white","py-3","rounded-lg","hover:bg-gray-600","transition","font-medium","disabled:opacity-50",3,"click","disabled"],[1,"ri-refresh-line","mr-2"],[1,"bg-yellow-50","border","border-yellow-200","rounded-lg","p-4"],[1,"flex","items-start"],[1,"ri-information-line","text-yellow-600","text-lg","mt-0.5","mr-3"],[1,"font-medium","text-yellow-800","mb-1"],[1,"text-sm","text-yellow-700"],[1,"p-3","bg-red-100","border","border-red-400","text-red-700","rounded-lg","text-sm"],[1,"flex","items-center","justify-center"],[1,"ri-loader-4-line","animate-spin","mr-2"],[1,"text-center","py-8"],[1,"inline-flex","items-center"],[1,"ri-loader-4-line","animate-spin","text-blue-600","text-2xl","mr-3"],[1,"text-gray-600"]],template:function(t,i){t&1&&(c(0,"div",0)(1,"div",1)(2,"div")(3,"div",2),g(4,"i",3),l(),c(5,"h2",4),d(6," Multi-Factor Authentication "),l(),c(7,"p",5),d(8," Please enter the verification code sent to your registered device "),l()(),c(9,"div",6),T(10,me,30,11,"div",7)(11,ge,5,0,"div",8),l(),c(12,"div",9)(13,"p",10),d(14," Having trouble? Contact support at "),c(15,"a",11),d(16," security@ugandamedicalregistry.com "),l()()()()()),t&2&&(p(10),f("ngIf",i.challenge),p(),f("ngIf",!i.challenge),p(4),f("href","mailto:"+i.supportEmail,R))},dependencies:[Z,te,ie,ne,re,Q],styles:[".verification-input[_ngcontent-%COMP%]{letter-spacing:.5em;text-align:center}.countdown-timer[_ngcontent-%COMP%]{font-variant-numeric:tabular-nums}.security-notice[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#fde68a)}.challenge-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ffffffe6,#f8fafccc);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(148,163,184,.2)}.verification-button[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.verification-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 14px #3b82f64d}.resend-button[_ngcontent-%COMP%]{transition:all .3s ease}.resend-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px)}@media (max-width: 640px){.verification-input[_ngcontent-%COMP%]{font-size:1.5rem;letter-spacing:.3em}}"]})};var N=class s{router=y(B);route=y(ee);auditService=y(b);reason="";requestId="";supportEmail="security@ugandamedicalregistry.com";ngOnInit(){this.reason=this.route.snapshot.queryParams.reason||"Access denied due to security policy",this.requestId=this.generateRequestId(),this.logAccessDenial()}logAccessDenial(){return n(this,null,function*(){let e=this.getCurrentUser();e&&(yield this.auditService.logAdminAction(e.id,e.role,"ACCESS_DENIED_PAGE_VIEW","security",this.requestId,!1,this.reason,{userAgent:navigator.userAgent,timestamp:new Date,referrer:document.referrer}))})}goBack(){window.history.back()}goHome(){this.router.navigate(["/"])}contactSupport(){let e=encodeURIComponent(`Access Denied - Request ID: ${this.requestId}`),t=encodeURIComponent(`
      I was denied access to a resource in the Uganda Medical Registry system.
      
      Request ID: ${this.requestId}
      Reason: ${this.reason}
      Timestamp: ${new Date().toISOString()}
      
      Please review my access permissions.
    `);window.location.href=`mailto:${this.supportEmail}?subject=${e}&body=${t}`}getCurrentUser(){let e=localStorage.getItem("currentUser");return e?JSON.parse(e):null}generateRequestId(){return"AD_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=E({type:s,selectors:[["app-access-denied"]],decls:47,vars:4,consts:[[1,"min-h-screen","flex","items-center","justify-center","bg-gray-50","py-12","px-4","sm:px-6","lg:px-8"],[1,"max-w-md","w-full","space-y-8"],[1,"text-center"],[1,"mx-auto","h-16","w-16","flex","items-center","justify-center","rounded-full","bg-red-100"],[1,"ri-shield-cross-line","text-red-600","text-3xl"],[1,"mt-6","text-3xl","font-extrabold","text-gray-900"],[1,"mt-2","text-sm","text-gray-600"],[1,"bg-white","rounded-lg","shadow-md","p-8"],[1,"mb-6"],[1,"text-lg","font-medium","text-gray-800","mb-2"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4"],[1,"text-sm","text-red-800"],[1,"bg-gray-50","border","border-gray-200","rounded-lg","p-3"],[1,"text-sm","font-mono","text-gray-700"],[1,"text-xs","text-gray-500","mt-1"],[1,"space-y-3"],[1,"w-full","bg-gray-500","text-white","py-3","rounded-lg","hover:bg-gray-600","transition","font-medium",3,"click"],[1,"ri-arrow-left-line","mr-2"],[1,"w-full","bg-blue-600","text-white","py-3","rounded-lg","hover:bg-blue-700","transition","font-medium",3,"click"],[1,"ri-home-line","mr-2"],[1,"w-full","bg-green-600","text-white","py-3","rounded-lg","hover:bg-green-700","transition","font-medium",3,"click"],[1,"ri-customer-service-line","mr-2"],[1,"mt-6","bg-yellow-50","border","border-yellow-200","rounded-lg","p-4"],[1,"flex","items-start"],[1,"ri-information-line","text-yellow-600","text-lg","mt-0.5","mr-3"],[1,"font-medium","text-yellow-800","mb-1"],[1,"text-sm","text-yellow-700"],[1,"text-xs","text-gray-500"],[1,"text-blue-600","hover:underline",3,"href"]],template:function(t,i){t&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),g(4,"i",4),l(),c(5,"h2",5),d(6," Access Denied "),l(),c(7,"p",6),d(8," You don't have permission to access this resource "),l()(),c(9,"div",7)(10,"div",8)(11,"h3",9),d(12,"Reason"),l(),c(13,"div",10)(14,"p",11),d(15),l()()(),c(16,"div",8)(17,"h3",9),d(18,"Request ID"),l(),c(19,"div",12)(20,"code",13),d(21),l()(),c(22,"p",14),d(23," Please include this ID when contacting support "),l()(),c(24,"div",15)(25,"button",16),v("click",function(){return i.goBack()}),g(26,"i",17),d(27," Go Back "),l(),c(28,"button",18),v("click",function(){return i.goHome()}),g(29,"i",19),d(30," Go to Homepage "),l(),c(31,"button",20),v("click",function(){return i.contactSupport()}),g(32,"i",21),d(33," Contact Support "),l()(),c(34,"div",22)(35,"div",23),g(36,"i",24),c(37,"div")(38,"h4",25),d(39,"Security Notice"),l(),c(40,"p",26),d(41," This access attempt has been logged for security monitoring. Repeated unauthorized access attempts may result in account suspension. "),l()()()()(),c(42,"div",2)(43,"p",27),d(44," Need help? Contact our security team at "),c(45,"a",28),d(46),l()()()()()),t&2&&(p(15),I(i.reason),p(6),I(i.requestId),p(24),f("href","mailto:"+i.supportEmail,R),p(),k(" ",i.supportEmail," "))},styles:[".access-denied-container[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f8fafc,#f1f5f9)}.security-notice[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#fde68a)}.action-button[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.action-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 14px #0003}.request-id-box[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f8fafc,#f1f5f9);border:1px solid rgba(148,163,184,.2)}@media (max-width: 640px){.access-denied-container[_ngcontent-%COMP%]{padding:16px}}"]})};var fe=[{path:"mfa-challenge",component:F},{path:"access-denied",component:N}],U=class s{static \u0275fac=function(t){return new(t||s)};static \u0275mod=M({type:s});static \u0275inj=P({imports:[q.forChild(fe),q]})};var O=class s{BLOCKCHAIN_ENDPOINT="https://blockchain.ugandamedicalregistry.com/api/v1";NETWORK_ID="umr-private-network";constructor(){}recordLicenseAction(e,t,i,r){return n(this,null,function*(){let a={licenseNumber:this.hashLicenseNumber(e),action:t,timestamp:new Date().toISOString(),performedBy:this.hashUserId(i)},o=yield this.generateHash(JSON.stringify(a)),u={id:this.generateRecordId(),type:t,licenseNumber:this.hashLicenseNumber(e),hash:o,timestamp:new Date,blockNumber:yield this.getNextBlockNumber(),previousHash:yield this.getLastBlockHash(),signature:yield this.signRecord(o),metadata:{action:t,performedBy:this.hashUserId(i),reason:r}};return yield this.submitToBlockchain(u),u})}verifyLicenseRecord(e){return n(this,null,function*(){let t=this.hashLicenseNumber(e);return{isValid:!0,blockNumber:12547,confirmations:6,timestamp:new Date,hash:yield this.generateHash(t)}})}getLicenseAuditTrail(e){return n(this,null,function*(){let t=this.hashLicenseNumber(e);return[{id:"BLK-001",type:"license_issued",licenseNumber:t,hash:yield this.generateHash("license_issued_"+t),timestamp:new Date("2023-01-15"),blockNumber:10234,previousHash:"prev_hash_123",signature:"sig_456",metadata:{action:"license_issued",performedBy:this.hashUserId("mdc_admin_001"),reason:"Initial registration"}}]})}validateChainIntegrity(){return n(this,null,function*(){return!0})}generateHash(e){return n(this,null,function*(){let i=new TextEncoder().encode(e),r=yield crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")})}hashLicenseNumber(e){return"HASH_"+e.replace(/[^A-Z0-9]/g,"")}hashUserId(e){return"USER_HASH_"+e.replace(/[^A-Z0-9]/g,"")}generateRecordId(){return"BLK_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}getNextBlockNumber(){return n(this,null,function*(){return Math.floor(Math.random()*1e5)+1e4})}getLastBlockHash(){return n(this,null,function*(){return yield this.generateHash("last_block_"+Date.now())})}signRecord(e){return n(this,null,function*(){return yield this.generateHash("signature_"+e)})}submitToBlockchain(e){return n(this,null,function*(){console.log("Blockchain record submitted:",e.id)})}static \u0275fac=function(t){return new(t||s)};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};var L=class s{HSM_ENDPOINT="https://hsm.ugandamedicalregistry.com/api/v1";FIELD_ENCRYPTION_KEYS=new Map;SENSITIVE_FIELDS=["nationalId","dateOfBirth","personalAddress","phoneNumber","email","medicalHistory","financialData","investigationNotes","disciplinaryRecords"];constructor(){this.initializeEncryptionKeys()}encryptField(e,t){return n(this,null,function*(){if(!this.isSensitiveField(e))throw new Error(`Field ${e} is not configured for encryption`);let i=yield this.getEncryptionKeyId(e),r=yield this.getHsmKey(i),a=crypto.getRandomValues(new Uint8Array(16));return{encryptedValue:yield this.performEncryption(t,r,a),keyId:i,algorithm:"AES-256-GCM",iv:Array.from(a).map(u=>u.toString(16).padStart(2,"0")).join(""),timestamp:new Date}})}decryptField(e){return n(this,null,function*(){let t=yield this.getHsmKey(e.keyId),i=new Uint8Array(e.iv.match(/.{1,2}/g).map(r=>parseInt(r,16)));return yield this.performDecryption(e.encryptedValue,t,i)})}encryptObject(e){return n(this,null,function*(){let t=x({},e);for(let[i,r]of Object.entries(e))this.isSensitiveField(i)&&typeof r=="string"&&(t[i]=yield this.encryptField(i,r));return t})}decryptObject(e){return n(this,null,function*(){let t=x({},e);for(let[i,r]of Object.entries(e))this.isSensitiveField(i)&&this.isEncryptedField(r)&&(t[i]=yield this.decryptField(r));return t})}rotateEncryptionKeys(){return n(this,null,function*(){for(let e of this.SENSITIVE_FIELDS)yield this.rotateFieldKey(e)})}getKeyMetadata(e){return n(this,null,function*(){return{id:e,algorithm:"AES-256-GCM",keySize:256,createdDate:new Date("2024-01-01"),expiryDate:new Date("2025-01-01"),status:"active",hsmBacked:!0}})}initializeEncryptionKeys(){return n(this,null,function*(){for(let e of this.SENSITIVE_FIELDS)this.FIELD_ENCRYPTION_KEYS.set(e,`HSM_KEY_${e.toUpperCase()}_001`)})}isSensitiveField(e){return this.SENSITIVE_FIELDS.includes(e)}isEncryptedField(e){return e&&typeof e=="object"&&"encryptedValue"in e&&"keyId"in e}getEncryptionKeyId(e){return n(this,null,function*(){return this.FIELD_ENCRYPTION_KEYS.get(e)||"DEFAULT_KEY_001"})}getHsmKey(e){return n(this,null,function*(){let t=new Uint8Array(32);return crypto.getRandomValues(t),yield crypto.subtle.importKey("raw",t,{name:"AES-GCM"},!1,["encrypt","decrypt"])})}performEncryption(e,t,i){return n(this,null,function*(){let a=new TextEncoder().encode(e),o=yield crypto.subtle.encrypt({name:"AES-GCM",iv:i},t,a);return Array.from(new Uint8Array(o)).map(u=>u.toString(16).padStart(2,"0")).join("")})}performDecryption(e,t,i){return n(this,null,function*(){let r=new Uint8Array(e.match(/.{1,2}/g).map(u=>parseInt(u,16))),a=yield crypto.subtle.decrypt({name:"AES-GCM",iv:i},t,r);return new TextDecoder().decode(a)})}rotateFieldKey(e){return n(this,null,function*(){let t=`HSM_KEY_${e.toUpperCase()}_${Date.now()}`;this.FIELD_ENCRYPTION_KEYS.set(e,t),console.log(`Rotated encryption key for field: ${e}`)})}static \u0275fac=function(t){return new(t||s)};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};var V=class s{DLP_ENDPOINT="https://dlp.ugandamedicalregistry.com/api/v1";userAccessCounts=new Map;dlpPolicies=[{id:"DLP-001",name:"Practitioner Data Access Policy",resourceType:"practitioner",rules:{maxViewsPerHour:50,maxExportsPerDay:10,requiresJustification:!0,watermarkRequired:!0,allowedUserRoles:["admin","inspector","council_admin"],timeRestrictions:{startHour:6,endHour:22,allowedDays:[1,2,3,4,5]}},violations:{action:"block",notifyAdmins:!0,escalationThreshold:3},active:!0},{id:"DLP-002",name:"Investigation Data Policy",resourceType:"investigation",rules:{maxViewsPerHour:20,maxExportsPerDay:5,requiresJustification:!0,watermarkRequired:!0,allowedUserRoles:["admin","inspector"],allowedIpRanges:["192.168.1.0/24","10.0.0.0/8"]},violations:{action:"block",notifyAdmins:!0,escalationThreshold:1},active:!0},{id:"DLP-003",name:"Financial Data Policy",resourceType:"financial",rules:{maxViewsPerHour:30,maxExportsPerDay:3,requiresJustification:!0,watermarkRequired:!0,allowedUserRoles:["admin","finance_admin"]},violations:{action:"block",notifyAdmins:!0,escalationThreshold:2},active:!0}];constructor(){}checkAccessCompliance(e){return n(this,null,function*(){let t=this.dlpPolicies.find(o=>o.resourceType===e.resourceType);if(!t||!t.active)return{allowed:!0,requiresWatermark:!1,policyViolations:[]};let i=[],r=this.getUserAccessCounts(e.userId);if(e.action==="view"&&r.views>=t.rules.maxViewsPerHour&&i.push("Exceeded hourly view limit"),e.action==="export"&&r.exports>=t.rules.maxExportsPerDay&&i.push("Exceeded daily export limit"),t.rules.requiresJustification&&!e.justification.trim()&&i.push("Access justification required"),t.rules.timeRestrictions){let o=new Date,u=o.getHours(),C=o.getDay();(u<t.rules.timeRestrictions.startHour||u>t.rules.timeRestrictions.endHour)&&i.push("Access outside allowed hours"),t.rules.timeRestrictions.allowedDays.includes(C)||i.push("Access not allowed on this day")}t.rules.allowedIpRanges&&!this.isIpInAllowedRanges(e.ipAddress,t.rules.allowedIpRanges)&&i.push("IP address not in allowed ranges");let a=i.length===0;return!a&&t.violations.action==="block"&&(yield this.recordViolation(e,t,i)),a&&this.updateAccessCounts(e.userId,e.action),{allowed:a,reason:i.join("; "),requiresWatermark:t.rules.watermarkRequired,policyViolations:i}})}applyWatermark(e,t,i,r){return n(this,null,function*(){let a=`CONFIDENTIAL - Accessed by ${t} on ${i.toISOString()} - ${r}`;return console.log(`Applying watermark: ${a}`),e})}throttleAccess(e,t){return n(this,null,function*(){let i=yield this.analyzeUserBehavior(e,t);return i.suspiciousActivity?Math.min(i.riskScore*1e3,1e4):0})}getDlpViolations(e,t,i){return n(this,null,function*(){return[]})}getUserAccessCounts(e){let t=new Date,i=this.userAccessCounts.get(e);return(!i||this.shouldResetCounts(i.lastReset,t))&&(i={views:0,exports:0,lastReset:t},this.userAccessCounts.set(e,i)),i}updateAccessCounts(e,t){let i=this.getUserAccessCounts(e);t==="view"?i.views++:t==="export"&&i.exports++,this.userAccessCounts.set(e,i)}shouldResetCounts(e,t){return(t.getTime()-e.getTime())/36e5>=1}isIpInAllowedRanges(e,t){return t.some(i=>e.startsWith(i.split("/")[0].substring(0,10)))}recordViolation(e,t,i){return n(this,null,function*(){let r={id:this.generateViolationId(),userId:e.userId,policyId:t.id,violationType:i.join(", "),description:`DLP policy violation: ${i.join("; ")}`,timestamp:new Date,severity:this.calculateSeverity(i),blocked:t.violations.action==="block",investigated:!1};console.log("DLP Violation recorded:",r),t.violations.notifyAdmins&&(yield this.notifyAdmins(r))})}analyzeUserBehavior(e,t){return n(this,null,function*(){return{userId:e,resourceType:t,accessCount:Math.floor(Math.random()*100),lastAccess:new Date,suspiciousActivity:Math.random()>.9,riskScore:Math.floor(Math.random()*10)+1}})}calculateSeverity(e){return e.some(t=>t.includes("IP address")||t.includes("unauthorized"))?"critical":e.some(t=>t.includes("limit")||t.includes("time"))?"high":e.some(t=>t.includes("justification"))?"medium":"low"}notifyAdmins(e){return n(this,null,function*(){console.log(`Admin notification sent for DLP violation: ${e.id}`)})}generateViolationId(){return"DLP_VIO_"+Date.now()+"_"+Math.random().toString(36).substr(2,6)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};var K=class s{RESIDENCY_CONFIGS=[{country:"Uganda",region:"East Africa",dataCenter:"Kampala Primary DC",endpoint:"https://ug.ugandamedicalregistry.com",encryptionKeys:["UG_PRIMARY_KEY_001","UG_BACKUP_KEY_001"],backupLocations:["Kampala Secondary DC","Entebbe Backup DC"],complianceRequirements:["Uganda Data Protection Act","East African Data Governance Framework"]},{country:"Kenya",region:"East Africa",dataCenter:"Nairobi Primary DC",endpoint:"https://ke.ugandamedicalregistry.com",encryptionKeys:["KE_PRIMARY_KEY_001","KE_BACKUP_KEY_001"],backupLocations:["Nairobi Secondary DC","Mombasa Backup DC"],complianceRequirements:["Kenya Data Protection Act","East African Data Governance Framework"]},{country:"Tanzania",region:"East Africa",dataCenter:"Dar es Salaam Primary DC",endpoint:"https://tz.ugandamedicalregistry.com",encryptionKeys:["TZ_PRIMARY_KEY_001","TZ_BACKUP_KEY_001"],backupLocations:["Dar es Salaam Secondary DC","Dodoma Backup DC"],complianceRequirements:["Tanzania Data Protection Act","East African Data Governance Framework"]}];constructor(){}getResidencyConfig(e){return this.RESIDENCY_CONFIGS.find(t=>t.country.toLowerCase()===e.toLowerCase())||null}enforceDataResidency(e,t,i){return n(this,null,function*(){let r=this.getResidencyConfig(t);if(!r)return{success:!1,endpoint:"",reason:`No data residency configuration found for ${t}`};let a=this.selectEndpoint(r,i),o=yield this.validateCompliance(e,r);return o.compliant?{success:!0,endpoint:a}:{success:!1,endpoint:a,reason:`Compliance violation: ${o.violations.join(", ")}`}})}requestCrossBorderAccess(e,t,i,r,a){return n(this,null,function*(){let o={id:this.generateRequestId(),sourceCountry:e,targetCountry:t,dataType:i,purpose:r,requestedBy:a,approvalRequired:this.requiresApproval(e,t,i),status:"pending"};return o.approvalRequired||(o.status="approved",o.approvedBy="AUTO_APPROVED",o.approvalDate=new Date,o.expiryDate=new Date(Date.now()+30*24*60*60*1e3)),yield this.storeCrossBorderRequest(o),o})}configureHighAvailability(e){return n(this,null,function*(){let t=this.getResidencyConfig(e);if(!t)throw new Error(`No HA configuration available for ${e}`);return{primaryDc:t.dataCenter,secondaryDc:t.backupLocations[0],syncStatus:"healthy",lastSync:new Date,rpoMinutes:5,rtoMinutes:15}})}initiateDrProcedure(e,t){return n(this,null,function*(){if(!this.getResidencyConfig(e))throw new Error(`No DR configuration available for ${e}`);let r={success:!0,newPrimaryEndpoint:`https://dr.${e.toLowerCase()}.ugandamedicalregistry.com`,estimatedRecoveryTime:15,dataLoss:!1};return console.log(`DR procedure initiated for ${e}: ${t}`),r})}selectEndpoint(e,t){switch(t){case"store":case"process":return e.endpoint;case"backup":return e.endpoint.replace("https://","https://backup.");default:return e.endpoint}}validateCompliance(e,t){return n(this,null,function*(){let i=[];return this.containsRestrictedData(e)&&i.push("Data contains cross-border restricted information"),this.isProperlyEncrypted(e)||i.push("Data not properly encrypted for cross-border storage"),{compliant:i.length===0,violations:i}})}containsRestrictedData(e){return["nationalId","medicalHistory","investigationNotes"].some(i=>e[i]&&!this.isEncrypted(e[i]))}isProperlyEncrypted(e){return!0}isEncrypted(e){return e&&typeof e=="object"&&"encryptedValue"in e}requiresApproval(e,t,i){let r=["investigation","disciplinary","financial"],a={"Uganda-Kenya":!1,"Uganda-Tanzania":!1,"Uganda-Rwanda":!1,"Uganda-Other":!0},o=`${e}-${t==="Kenya"||t==="Tanzania"||t==="Rwanda"?t:"Other"}`;return a[o]||r.includes(i)}generateRequestId(){return"CBR_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}storeCrossBorderRequest(e){return n(this,null,function*(){console.log(`Cross-border request stored: ${e.id}`)})}static \u0275fac=function(t){return new(t||s)};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};var $=class s{BACKUP_ENDPOINT="https://backup.ugandamedicalregistry.com/api/v1";DR_ENDPOINT="https://dr.ugandamedicalregistry.com/api/v1";backupConfigs=[{id:"BACKUP-001",name:"Practitioner Registry - Full Backup",type:"full",schedule:{frequency:"daily",time:"02:00",daysOfWeek:[0,1,2,3,4,5,6]},retention:{daily:7,weekly:4,monthly:12,yearly:7},encryption:{enabled:!0,keyId:"BACKUP_KEY_001",algorithm:"AES-256-GCM"},destinations:[{id:"DEST-001",type:"local",location:"Kampala Primary DC",endpoint:"https://backup-local.ugandamedicalregistry.com",encryption:!0,compression:!0,priority:1},{id:"DEST-002",type:"offsite",location:"Entebbe Backup Facility",endpoint:"https://backup-offsite.ugandamedicalregistry.com",encryption:!0,compression:!0,priority:2},{id:"DEST-003",type:"cloud",location:"AWS Africa (Cape Town)",endpoint:"https://s3.af-south-1.amazonaws.com/umr-backups",encryption:!0,compression:!0,priority:3}],lastRun:new Date("2025-01-15T02:00:00"),nextRun:new Date("2025-01-16T02:00:00"),status:"active"},{id:"BACKUP-002",name:"Audit Logs - Incremental Backup",type:"incremental",schedule:{frequency:"hourly",time:"00"},retention:{daily:30,weekly:12,monthly:24,yearly:10},encryption:{enabled:!0,keyId:"AUDIT_BACKUP_KEY_001",algorithm:"AES-256-GCM"},destinations:[{id:"DEST-004",type:"local",location:"Kampala Audit DC",endpoint:"https://audit-backup.ugandamedicalregistry.com",encryption:!0,compression:!1,priority:1}],lastRun:new Date("2025-01-15T14:00:00"),nextRun:new Date("2025-01-15T15:00:00"),status:"active"}];drPlans=[{id:"DR-001",scenario:"Primary Data Center Failure",rpoMinutes:5,rtoMinutes:15,steps:[{order:1,description:"Detect primary DC failure",estimatedTime:2,automated:!0,responsible:"Monitoring System",dependencies:[]},{order:2,description:"Activate secondary DC",estimatedTime:5,automated:!0,responsible:"Failover System",dependencies:["step-1"]},{order:3,description:"Update DNS routing",estimatedTime:3,automated:!0,responsible:"DNS Management",dependencies:["step-2"]},{order:4,description:"Verify data integrity",estimatedTime:5,automated:!1,responsible:"DBA Team",dependencies:["step-3"]}],lastTested:new Date("2024-12-01"),testResults:[{testDate:new Date("2024-12-01"),scenario:"Primary DC Failure Simulation",actualRpo:3,actualRto:12,success:!0,issues:[],recommendations:["Consider faster DNS propagation"]}]}];constructor(){this.initializeBackupMonitoring()}initiateBackup(e){return n(this,null,function*(){let t=this.backupConfigs.find(r=>r.id===e);if(!t)throw new Error(`Backup configuration not found: ${e}`);let i={id:this.generateJobId(),configId:e,type:t.type,startTime:new Date,status:"running",dataSize:0,compressedSize:0,verificationStatus:"pending"};return yield this.executeBackup(i,t),i})}verifyBackupIntegrity(e){return n(this,null,function*(){return{valid:!0,checksumMatch:!0,dataComplete:!0,issues:[]}})}restoreFromBackup(e,t,i,r){return n(this,null,function*(){return console.log(`Initiating restore from backup ${e} to ${t}`),{success:!0,restoredSize:1024*1024*1024,duration:300,issues:[]}})}testDisasterRecovery(e){return n(this,null,function*(){let t=this.drPlans.find(r=>r.id===e);if(!t)throw new Error(`DR plan not found: ${e}`);let i={testDate:new Date,scenario:t.scenario,actualRpo:t.rpoMinutes+Math.floor(Math.random()*3),actualRto:t.rtoMinutes+Math.floor(Math.random()*5),success:!0,issues:[],recommendations:[]};return i.actualRpo>t.rpoMinutes&&i.issues.push(`RPO target missed: ${i.actualRpo} > ${t.rpoMinutes} minutes`),i.actualRto>t.rtoMinutes&&i.issues.push(`RTO target missed: ${i.actualRto} > ${t.rtoMinutes} minutes`),i.success=i.issues.length===0,t.testResults.push(i),t.lastTested=new Date,i})}getBackupStatus(){return n(this,null,function*(){return{totalConfigs:this.backupConfigs.length,activeJobs:2,lastSuccessfulBackup:new Date,totalDataProtected:50*1024*1024*1024,compressionRatio:.65,healthScore:98.5}})}initializeBackupMonitoring(){return n(this,null,function*(){setInterval(()=>{this.checkScheduledBackups()},6e4)})}checkScheduledBackups(){return n(this,null,function*(){let e=new Date;for(let t of this.backupConfigs)t.status==="active"&&e>=t.nextRun&&(yield this.initiateBackup(t.id),this.updateNextRunTime(t))})}updateNextRunTime(e){let t=new Date;switch(e.schedule.frequency){case"hourly":e.nextRun=new Date(t.getTime()+60*60*1e3);break;case"daily":e.nextRun=new Date(t.getTime()+24*60*60*1e3);break;case"weekly":e.nextRun=new Date(t.getTime()+7*24*60*60*1e3);break;case"monthly":e.nextRun=new Date(t.getTime()+30*24*60*60*1e3);break}}executeBackup(e,t){return n(this,null,function*(){try{e.dataSize=Math.floor(Math.random()*1e9)+1e8,e.compressedSize=Math.floor(e.dataSize*.65),setTimeout(()=>{e.endTime=new Date,e.duration=e.endTime.getTime()-e.startTime.getTime(),e.status="completed",e.verificationStatus="verified",console.log(`Backup job completed: ${e.id}`)},5e3)}catch(i){e.status="failed",e.errorMessage=i instanceof Error?i.message:"Unknown error",e.endTime=new Date}})}generateJobId(){return"BACKUP_JOB_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};var ae=class s{static \u0275fac=function(t){return new(t||s)};static \u0275mod=M({type:s});static \u0275inj=P({providers:[O,L,b,V,D,K,$],imports:[X,se,U]})};export{b as a,O as b,L as c,V as d,ae as e};
